@if (isPermitted()) {
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0 d-flex align-items-center">
                    <i class="fa fa-users me-2 text-primary"></i>
                    لیست کاربران
                    @if (loading()) {
                    <div class="spinner-border spinner-border-sm ms-2" role="status">
                        <span class="visually-hidden">در حال بارگذاری...</span>
                    </div>
                    }
                </h5>

                <div class="header-actions">
                    <!-- فیلترها اگر نیاز باشد -->
                    <app-label-button identifier="refreshBtn" label="به‌روزرسانی" class="outline-secondary"
                        (clicked)="getRecords()">
                        <i class="fa fa-refresh me-1"></i>
                    </app-label-button>
                </div>
            </div>

            <div class="card-body">
                @if (loading()) {
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">در حال بارگذاری...</span>
                    </div>
                    <p class="mt-3 text-muted">در حال بارگذاری کاربران...</p>
                </div>
                } @else if (!hasRecords()) {
                <div class="text-center py-5">
                    <i class="fa fa-users fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">هیچ کاربری یافت نشد</h5>
                    <p class="text-muted">با کلاینت فعلی کاربری وجود ندارد.</p>
                </div>
                } @else {
                <!-- AG Grid -->
                <div class="grid-container">
                    <ag-grid-angular #agGrid id="usersGrid" [components]="components"
                        class="ag-theme-material ag-grid-custom font-sahel" style="height: 640px; width: 100%;"
                        [rowData]="records()" [gridOptions]="gridOptions()" [modules]="modules()"
                        (gridReady)="onGridReady($event)" [loadingOverlayComponent]="'customLoadingOverlay'"
                        [noRowsOverlayComponent]="'customNoRowsOverlay'">
                    </ag-grid-angular>
                </div>

                <!-- Grid Actions -->
                <div class="grid-actions mt-3 d-flex justify-content-between align-items-center">
                    <div class="grid-info">
                        <small class="text-muted">
                            نمایش {{ records().length }} کاربر
                        </small>
                    </div>

                    <div class="grid-controls btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-secondary" (click)="onExportExcel()"
                            title="خروجی Excel">
                            <i class="fa fa-file-excel"></i>
                        </button>
                        <button type="button" class="btn btn-outline-secondary" (click)="removeAllFilters()"
                            title="حذف فیلترها">
                            <i class="fa fa-filter"></i>
                        </button>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>
</div>
} @else {
<!-- No Permission State -->
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card text-center">
            <div class="card-body py-5">
                <i class="fa fa-lock fa-3x text-warning mb-3"></i>
                <h5 class="text-muted">عدم دسترسی</h5>
                <p class="text-muted">شما مجوز مشاهده این صفحه را ندارید.</p>
                <app-label-button identifier="backBtn" label="بازگشت به داشبورد" variant="primary"
                    (clicked)="router.navigate(['/dashboard'])">
                </app-label-button>
            </div>
        </div>
    </div>
</div>
}