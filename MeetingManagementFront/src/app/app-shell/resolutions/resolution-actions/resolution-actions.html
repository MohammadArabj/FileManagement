<div class="container-fluid py-4">
    <!-- Header Card -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="fw-bold text-primary mb-0">
                    <i class="fa fa-tasks ms-2"></i>
                    Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ùˆ Ù¾ÛŒÚ¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§
                </h4>
                <button class="btn btn-outline-secondary" (click)="onBackClick()">
                    <i class="fa fa-arrow-right ms-1"></i>Ø¨Ø§Ø²Ú¯Ø´Øª
                </button>
            </div>

            <!-- Resolution Info -->
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="info-box">
                        <small class="text-muted">
                            <i class="fa fa-hashtag ms-1"></i>Ø´Ù…Ø§Ø±Ù‡ Ø¬Ù„Ø³Ù‡
                        </small>
                        <div class="fw-semibold">{{ resolutionData().meetingNumber }}</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="info-box">
                        <small class="text-muted">
                            <i class="fa fa-calendar ms-1"></i>ØªØ§Ø±ÛŒØ®
                        </small>
                        <div class="fw-semibold">{{ resolutionData().meetingDate }}</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-box">
                        <small class="text-muted">
                            <i class="fa fa-file-alt ms-1"></i>Ø¹Ù†ÙˆØ§Ù† Ø¬Ù„Ø³Ù‡
                        </small>
                        <div class="fw-semibold">{{ resolutionData().meetingTitle }}</div>
                    </div>
                </div>
            </div>

            <div class="row g-3 mt-2">
                <div class="col-md-3">
                    <div class="info-box">
                        <small class="text-muted">
                            <i class="fa fa-bookmark ms-1"></i>Ø´Ù…Ø§Ø±Ù‡ Ù…ØµÙˆØ¨Ù‡
                        </small>
                        <span class="badge bg-light text-dark border">
                            {{ resolutionData().resolutionNumber }}
                        </span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-box">
                        <small class="text-muted">
                            <i class="fa fa-heading ms-1"></i>Ø¹Ù†ÙˆØ§Ù† Ù…ØµÙˆØ¨Ù‡
                        </small>
                        <div class="fw-semibold">{{ resolutionData().resolutionTitle }}</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="info-box">
                        <small class="text-muted">
                            <i class="fa fa-clock ms-1"></i>Ù…Ù‡Ù„Øª Ø§Ù‚Ø¯Ø§Ù…
                        </small>
                        <span class="badge bg-warning text-dark">
                            {{ resolutionData().dueDate }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    @if (isLoading()) {
    <div class="d-flex justify-content-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span>
        </div>
    </div>
    } @else {
    <!-- Actions and Followups Row -->
    <div class="row g-4">
        <!-- Actions Section -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-header bg-transparent py-3 border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="fw-bold mb-0">
                            <i class="fa fa-tasks text-primary ms-2"></i>Ø§Ù‚Ø¯Ø§Ù…Ø§Øª
                        </h5>
                        <div class="d-flex gap-2">
                            <span class="badge bg-primary-subtle text-primary">
                                {{ actionsCount() }} Ù…ÙˆØ±Ø¯
                            </span>
                            @if (userType() === 'action') {
                            <button class="btn btn-sm btn-primary" (click)="openActionModal('action')"
                                [disabled]="isSaving()">
                                <i class="fa fa-plus ms-1"></i>Ø§Ù‚Ø¯Ø§Ù… Ø¬Ø¯ÛŒØ¯
                            </button>
                            }
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="timeline-container">
                        @for (item of actions(); track item.id) {
                        <div class="timeline-item">
                            <div class="timeline-marker" [ngClass]="getStatusClass(item, 'action')">
                            </div>
                            <div class="timeline-content">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <span class="badge border"
                                            [ngClass]="'bg-' + getStatusClass(item, 'action').replace('bg-', '') + '-subtle text-' + getStatusClass(item, 'action').replace('bg-', '') + ' border-' + getStatusClass(item, 'action').replace('bg-', '')">
                                            <i class="fa fa-flag ms-1"></i>
                                            {{ getStatusLabel(item, 'action') }}
                                        </span>
                                        <small class="text-muted ms-2">
                                            <i class="fa fa-user ms-1"></i>{{ item.userName }}
                                        </small>
                                        <small class="text-muted ms-2">
                                            <i class="fa fa-calendar ms-1"></i>{{ item.date }}
                                        </small>
                                    </div>
                                    @if (canEditAction(item)) {
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary"
                                            (click)="editAction(item.id, 'action')" [disabled]="isSaving()">
                                            <i class="fa fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" (click)="deleteAction(item.id)"
                                            [disabled]="isSaving()">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                    }
                                </div>
                                <p class="mb-0 text-secondary">{{ item.description }}</p>
                            </div>
                        </div>
                        } @empty {
                        <div class="empty-holder text-center py-5">
                            <div class="empty-illustration mb-3" style="font-size: 3rem;">ğŸ’¤</div>
                            <div class="text-muted">Ù‡ÛŒÚ† Ø§Ù‚Ø¯Ø§Ù…ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡Ø› Ø§ÙˆÙ„ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</div>
                        </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Followups Section -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-header bg-transparent py-3 border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="fw-bold mb-0">
                            <i class="fa fa-eye text-success ms-2"></i>Ù¾ÛŒÚ¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§
                        </h5>
                        <div class="d-flex gap-2">
                            <span class="badge bg-success-subtle text-success">
                                {{ followupsCount() }} Ù…ÙˆØ±Ø¯
                            </span>
                            @if (userType() === 'follow') {
                            <button class="btn btn-sm btn-success" (click)="openActionModal('follow')"
                                [disabled]="isSaving()">
                                <i class="fa fa-plus ms-1"></i>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¬Ø¯ÛŒØ¯
                            </button>
                            }
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="timeline-container">
                        @for (item of followups(); track item.id) {
                        <div class="timeline-item">
                            <div class="timeline-marker" [ngClass]="getStatusClass(item, 'follow')">
                            </div>
                            <div class="timeline-content">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <span class="badge border"
                                            [ngClass]="'bg-' + getStatusClass(item, 'follow').replace('bg-', '') + '-subtle text-' + getStatusClass(item, 'follow').replace('bg-', '') + ' border-' + getStatusClass(item, 'follow').replace('bg-', '')">
                                            <i class="fa fa-eye ms-1"></i>
                                            {{ getStatusLabel(item, 'follow') }}
                                        </span>
                                        <small class="text-muted ms-2">
                                            <i class="fa fa-user ms-1"></i>{{ item.userName }}
                                        </small>
                                        <small class="text-muted ms-2">
                                            <i class="fa fa-calendar ms-1"></i>{{ item.date }}
                                        </small>
                                    </div>
                                    @if (canEditAction(item)) {
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary"
                                            (click)="editAction(item.id, 'follow')" [disabled]="isSaving()">
                                            <i class="fa fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" (click)="deleteAction(item.id)"
                                            [disabled]="isSaving()">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                    }
                                </div>
                                <p class="mb-0 text-secondary">{{ item.description }}</p>
                            </div>
                        </div>
                        } @empty {
                        <div class="empty-holder text-center py-5">
                            <div class="empty-illustration mb-3" style="font-size: 3rem;">ğŸ’¤</div>
                            <div class="text-muted">Ù‡ÛŒÚ† Ù¾ÛŒÚ¯ÛŒØ±ÛŒâ€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡Ø› Ø§ÙˆÙ„ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</div>
                        </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    }
</div>

<!-- Action/Follow Modal -->
<div class="modal fade" id="actionModal" tabindex="-1" aria-labelledby="actionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="actionModalLabel">
                    <i class="fa fa-plus-circle ms-2"></i>
                    {{ modalTitle() }}
                </h5>
                <button type="button" class="btn-close" (click)="closeModal()" aria-label="Ø¨Ø³ØªÙ†"></button>
            </div>

            <form (ngSubmit)="saveAction()" #actionForm="ngForm">
                <div class="modal-body">
                    <div class="row g-3">
                        <!-- Status Selection -->
                        @if (modalType() === 'action') {
                        <div class="col-12">
                            <label class="form-label fw-semibold">
                                <i class="fa fa-flag ms-1"></i>ÙˆØ¶Ø¹ÛŒØª Ø§Ù‚Ø¯Ø§Ù…
                                <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" [value]="selectedStatus()"
                                (change)="selectedStatus.set($any($event.target)?.value)" name="selectedStatus" required>
                                <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                                @for (option of actionStatusOptions; track option.value) {
                                <option [value]="option.value">{{ option.label }}</option>
                                }
                            </select>
                            <div class="invalid-feedback">
                                Ù„Ø·ÙØ§Ù‹ ÙˆØ¶Ø¹ÛŒØª Ø§Ù‚Ø¯Ø§Ù… Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
                            </div>
                        </div>
                        }

                        @if (modalType() === 'follow') {
                        <div class="col-12">
                            <label class="form-label fw-semibold">
                                <i class="fa fa-flag ms-1"></i>ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒÚ¯ÛŒØ±ÛŒ
                                <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" [value]="selectedStatus()"
                                (change)="selectedStatus.set($any($event.target)?.value)" name="selectedStatus" required>
                                <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                                @for (option of followStatusOptions; track option.value) {
                                <option [value]="option.value">{{ option.label }}</option>
                                }
                            </select>
                            <div class="invalid-feedback">
                                Ù„Ø·ÙØ§Ù‹ ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
                            </div>
                        </div>
                        }

                        <!-- Date Input -->
                        <div class="col-12">
                            <label class="form-label fw-semibold">
                                <i class="fa fa-calendar ms-1"></i>ØªØ§Ø±ÛŒØ®
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" [value]="actionDate()"
                                (input)="actionDate.set($any($event.target)?.value)" name="actionDate" data-jdp
                                placeholder="Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®..." required>
                            <div class="invalid-feedback">
                                Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="col-12">
                            <label class="form-label fw-semibold">
                                <i class="fa fa-comment-dots ms-1"></i>ØªÙˆØ¶ÛŒØ­Ø§Øª
                                @if (isDescriptionRequired()) {
                                <span class="text-danger">*</span>
                                }
                            </label>
                            <textarea rows="4" class="form-control" [value]="description()"
                                (input)="description.set($any($event.target)?.value)" name="description"
                                placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯Ù‚ÛŒÙ‚ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."
                                [required]="isDescriptionRequired()"></textarea>
                            <div class="invalid-feedback">
                                Ù„Ø·ÙØ§Ù‹ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
                            </div>
                            @if (!isDescriptionRequired()) {
                            <small class="form-text text-muted">
                                <i class="fa fa-info-circle ms-1"></i>
                                Ø¨Ø±Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª "Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡" ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ù†ÛŒØ³Øª
                            </small>
                            }
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" (click)="closeModal()"
                        [disabled]="isSaving()">
                        <i class="fa fa-times ms-1"></i>Ø§Ù†ØµØ±Ø§Ù
                    </button>
                    <button type="submit" class="btn btn-success" [disabled]="isSaving()">
                        @if (isSaving()) {
                        <span class="spinner-border spinner-border-sm ms-1"></span>
                        } @else {
                        <i class="fa fa-save ms-1"></i>
                        }
                        {{ editMode() ? 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ' : 'Ø°Ø®ÛŒØ±Ù‡' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>